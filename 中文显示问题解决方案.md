# 中文显示问题解决方案

## 问题描述

在某些情况下，HTML 文件中的中文可能显示为乱码，例如：
- `渚跨` 应该是 `便签`
- `鍥剧墖` 应该是 `图片`
- `绠ご` 应该是 `箭头`
- `鏂囧瓧妗?` 应该是 `文字框`
- `鍏ㄥ睆` 应该是 `全屏`

## 原因分析

这是文件编码问题导致的。文件可能在保存时使用了错误的编码（如 GBK），导致 UTF-8 字符被错误解析。

## 解决方法

### 方法一：运行修复脚本（推荐）

1. 双击运行 `修复中文乱码.bat` 文件
2. 等待提示"修复完成！"
3. 按任意键关闭窗口
4. 刷新浏览器页面

### 方法二：手动修复

使用支持 UTF-8 的文本编辑器（如 VS Code、Notepad++）：

1. 打开 `little-prince-journal-modular.html`
2. 查找并替换以下内容：
   - `TOOLS` → `工具`
   - `渚跨` → `便签`
   - `鍥剧墖` → `图片`
   - `绠ご` → `箭头`
   - `鏂囧瓧妗?` → `文字框`
   - `鍏ㄥ睆鎸夐挳` → `全屏按钮`
   - `鍏ㄥ睆棰勮` → `全屏预览`
3. 保存文件时选择 UTF-8 编码（不带 BOM）

### 方法三：使用 PowerShell

在文件所在目录打开 PowerShell，运行：

```powershell
$content = Get-Content 'little-prince-journal-modular.html' -Raw -Encoding UTF8
$content = $content -replace 'TOOLS', '工具'
$content = $content -replace 'title="渚跨"', 'title="便签"'
$content = $content -replace 'title="鍥剧墖"', 'title="图片"'
$content = $content -replace 'title="绠ご"', 'title="箭头"'
$content = $content -replace 'title="鏂囧瓧妗?"', 'title="文字框"'
$content = $content -replace '<!-- 鍏ㄥ睆鎸夐挳 -->', '<!-- 全屏按钮 -->'
$content = $content -replace 'title="鍏ㄥ睆棰勮"', 'title="全屏预览"'
[System.IO.File]::WriteAllText('little-prince-journal-modular.html', $content, [System.Text.Encoding]::UTF8)
```

## 预防措施

### 1. 使用正确的编辑器

推荐使用以下编辑器：
- **VS Code**（推荐）
  - 自动检测编码
  - 右下角显示当前编码
  - 可以轻松切换编码

- **Notepad++**
  - 编码 → 转为 UTF-8（无 BOM）
  - 设置 → 首选项 → 新建 → 编码：UTF-8（无 BOM）

- **Sublime Text**
  - File → Save with Encoding → UTF-8

### 2. 避免使用的编辑器

❌ **Windows 记事本**（旧版本）
- 可能使用 ANSI/GBK 编码
- 容易导致中文乱码

❌ **某些旧版 IDE**
- 默认编码可能不是 UTF-8

### 3. Git 配置

如果使用 Git，确保配置正确：

```bash
git config --global core.autocrlf false
git config --global core.safecrlf true
```

## 验证修复

修复后，打开 HTML 文件，检查以下位置：

1. **工具栏标签**
   - 应该显示"工具"而不是"TOOLS"

2. **工具提示**
   - 鼠标悬停在图标上时
   - 应该显示"便签"、"图片"、"箭头"、"文字框"

3. **全屏按钮**
   - 右上角按钮的提示
   - 应该显示"全屏预览"

## 常见问题

### Q: 修复后还是乱码怎么办？

A: 尝试以下步骤：
1. 清除浏览器缓存（Ctrl+Shift+Delete）
2. 完全关闭浏览器后重新打开
3. 使用无痕模式打开文件
4. 检查文件编码是否真的是 UTF-8

### Q: 为什么会出现这个问题？

A: 可能的原因：
1. 文件在不同编码之间转换时出错
2. 使用了不支持 UTF-8 的编辑器
3. Git 配置导致换行符或编码问题
4. 复制粘贴时编码丢失

### Q: 如何检查文件编码？

A: 
- **VS Code**: 右下角显示编码
- **Notepad++**: 编码菜单显示当前编码
- **PowerShell**: 
  ```powershell
  Get-Content 'file.html' -Encoding UTF8 | Select-String "工具"
  ```

### Q: 修复后会影响其他功能吗？

A: 不会。只是修复了显示文本，不影响任何功能。

## 技术说明

### UTF-8 编码

- UTF-8 是 Unicode 的一种实现方式
- 可以表示世界上所有语言的字符
- HTML5 标准推荐使用 UTF-8
- 文件开头应该有 `<meta charset="UTF-8">`

### BOM（Byte Order Mark）

- UTF-8 with BOM: 文件开头有 3 个字节（EF BB BF）
- UTF-8 without BOM: 没有额外字节（推荐）
- HTML 文件应该使用 UTF-8 without BOM

### 乱码原理

```
原始字符: 工具
UTF-8 编码: E5 B7 A5 E5 85 B7
错误解析为 GBK: 宸ュ叿
再转回 UTF-8: 渚跨
```

## 相关文档

- `如何清除旧数据.md` - 清除浏览器缓存数据
- `快速开始.md` - 应用使用指南
- `字符编码说明.md` - 详细的编码说明

## 更新日志

### v1.4.2 (2026-02-05)
- ✅ 创建修复脚本
- ✅ 添加详细说明文档
- ✅ 修复工具栏乱码

---

如有其他问题，请查看其他文档或联系技术支持。
