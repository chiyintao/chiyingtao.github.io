<html lang="zh-CN" vid="0"><head vid="1">
    <meta charset="UTF-8" vid="2">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" vid="3">
    <title vid="4">笔记</title>
    <script src="https://cdn.tailwindcss.com/3.4.17" vid="5"></script>
    <link href="https://fonts.googleapis.com/css2?family=Amatic+SC:wght@400;700&amp;family=Indie+Flower&amp;family=Inter:wght@300;400;500;600&amp;family=Long+Cang&amp;family=Reenie+Beanie&amp;display=swap" rel="stylesheet" vid="6">
    <style vid="7">
        :root {
            
            --bg-wall: #e8e9ec;
            --glass-surface: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.6);
            --neon-purple: #9d4edd;
            --neon-orange: #ff7900;
            --neon-gradient: linear-gradient(135deg, #9d4edd 0%, #ff9e00 100%);
            --neon-glow: 0 0 20px rgba(157, 78, 221, 0.4);
            
            
            --paper-bg: #fdfbf7;
            --ink-primary: #2c3e50;
            --ink-secondary: #7f8c8d;
            --line-color: #eaddcf;
            --highlight: #ff6b6b;
            --gold: #f1c40f;

            
            --font-ui: 'Inter', sans-serif;
            --font-hand: 'Indie Flower', cursive;
            --font-display: 'Amatic SC', cursive;
            --font-messy: 'Reenie Beanie', cursive;
        }

        body {
            background-color: var(--bg-wall);
            background-image: radial-gradient(circle at 50% 50%, #ffffff 0%, #d1d5db 100%);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: var(--font-ui);
        }

        
        .notebook-chassis {
            width: 95vw;
            max-width: 1400px;
            height: 90vh;
            max-height: 900px;
            background: #ffffff;
            border-radius: 40px;
            position: relative;
            box-shadow: 
                0 50px 100px -20px rgba(0,0,0,0.15),
                0 30px 60px -30px rgba(0,0,0,0.2),
                inset 0 0 0 2px rgba(255,255,255,0.8);
            display: grid;
            grid-template-columns: 260px 300px 1fr;
            overflow: hidden;
            padding: 12px;
            transition: all 0.3s ease;
        }

        .notebook-chassis.sidebar-collapsed {
            grid-template-columns: 60px 0px 1fr;
        }

        .notebook-chassis.chapters-collapsed {
            grid-template-columns: 260px 60px 1fr;
        }

        .notebook-chassis.all-collapsed {
            grid-template-columns: 60px 0px 1fr;
        }

        .notebook-chassis.fullscreen {
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            border-radius: 0;
            padding: 0;
        }

        .notebook-chassis::before {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 40px;
            padding: 2px;
            background: linear-gradient(160deg, rgba(255,255,255,0.8), rgba(255,255,255,0.2));
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
            pointer-events: none;
            z-index: 50;
        }

        
        .sidebar-spine {
            background: #f8f9fa;
            border-radius: 28px 0 0 28px;
            padding: 32px 20px;
            display: flex;
            flex-direction: column;
            border-right: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .sidebar-collapsed .sidebar-spine {
            padding: 32px 10px;
        }

        .brand-mark {
            font-family: var(--font-ui);
            font-size: 24px;
            color: var(--neon-purple);
            margin-bottom: 40px;
            font-weight: bold;
            letter-spacing: 2px;
        }

        .notebook-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 8px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .notebook-item:hover { background: rgba(0,0,0,0.02); }
        
        .notebook-item.active {
            background: #fff;
            color: #111;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            position: relative;
        }
        
        .notebook-item.active::before {
            content: '';
            position: absolute;
            left: 0; top: 8px; bottom: 8px;
            width: 4px;
            background: var(--neon-gradient);
            border-radius: 0 4px 4px 0;
        }

        .notebook-name {
            outline: none;
            flex: 1;
        }

        .notebook-name:focus {
            background: rgba(157, 78, 221, 0.1);
            border-radius: 4px;
            padding: 2px 4px;
        }

        .chapter-card [contenteditable] {
            outline: none;
        }

        .chapter-card [contenteditable]:focus {
            background: rgba(157, 78, 221, 0.05);
            border-radius: 4px;
            padding: 2px 4px;
        }

        
        .notes-panel {
            background: rgba(255,255,255,0.6);
            backdrop-filter: blur(10px);
            border-right: 1px solid rgba(0,0,0,0.05);
            padding: 24px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            transition: all 0.3s ease;
            position: relative;
        }

        .chapters-collapsed .notes-panel {
            padding: 24px 10px;
        }

        .chapters-collapsed .notes-panel > *:not(.expand-btn) {
            display: none;
        }

        .expand-btn {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 40px;
            height: 40px;
            background: white;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: all 0.2s;
            z-index: 10;
        }

        .chapters-collapsed .expand-btn {
            display: flex;
        }

        .expand-btn:hover {
            background: var(--neon-purple);
            color: white;
            transform: translate(-50%, -50%) scale(1.1);
        }

        .all-collapsed .notes-panel {
            width: 0;
            padding: 0;
            opacity: 0;
        }

        .chapter-card {
            background: #fff;
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 12px;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .chapter-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }

        .chapter-card.active {
            border-color: rgba(157, 78, 221, 0.3);
            box-shadow: 0 4px 15px rgba(157, 78, 221, 0.15);
        }

        .chapter-card.active .chapter-title {
            color: var(--neon-purple);
        }

        
        .editor-stage {
            background: #f0f2f5;
            border-radius: 0 28px 28px 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        
        .palette-bar {
            background: #fff;
            border-radius: 16px;
            padding: 10px 20px;
            display: flex;
            gap: 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.03);
            align-items: center;
            z-index: 20;
        }

        .palette-item {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            background: #f5f5f5;
            color: #666;
            border: 1px solid transparent;
        }

        .palette-item:hover {
            background: #fff;
            border-color: var(--neon-purple);
            color: var(--neon-purple);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(157, 78, 221, 0.2);
        }

        
        .paper-viewport {
            flex: 1;
            position: relative;
            overflow: hidden;
            display: flex;
            justify-content: center;
            perspective: 1000px;
        }

        .paper-page {
            width: 100%;
            max-width: 800px;
            background: var(--paper-bg);
            height: 100%;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            border-radius: 4px;
            position: relative;
            overflow: hidden;
            
            background-image: 
                linear-gradient(var(--line-color) 1px, transparent 1px);
            background-size: 100% 32px;
            background-position: 0 28px;
            padding: 60px 50px;
        }

        .paper-hole-punch {
            position: absolute;
            left: 20px;
            top: 0;
            bottom: 0;
            width: 40px;
            display: flex;
            flex-direction: column;
            gap: 20px;
            padding-top: 40px;
            pointer-events: none;
        }

        .hole {
            width: 16px;
            height: 16px;
            background: #e1e4e8;
            border-radius: 50%;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.2);
        }

        
        .draggable-element {
            position: absolute;
            cursor: grab;
            user-select: none;
            z-index: 10;
            transition: box-shadow 0.2s;
            overflow: visible; /* 纭繚鎵嬫焺鍙互鏄剧ず鍦ㄥ厓绱犲闈?*/
        }
        
        .draggable-element:active {
            cursor: grabbing;
            z-index: 100;
        }

        .draggable-element.selected {
            outline: 2px dashed var(--neon-orange);
            background: rgba(255, 255, 255, 0.5);
            z-index: 50; /* 閫変腑鏃舵彁楂樺眰绾?*/
        }

        .draggable-element.dragging {
            opacity: 0.8;
            z-index: 1000;
        }

        .draggable-content {
            width: 100%;
            height: 100%;
        }

        /* 榛樿绂佺敤鍐呭鐨刾ointer-events锛屽彧鍦ㄩ渶瑕佹椂鍚敤 */
        .draggable-content {
            pointer-events: none;
        }

        /* 鍙鍙紪杈戝厓绱犲惎鐢╬ointer-events */
        .sticker-note .draggable-content,
        .sticker-textbox .draggable-content {
            pointer-events: auto;
        }

        .sticker-note .draggable-content [contenteditable],
        .sticker-textbox .draggable-content [contenteditable] {
            pointer-events: auto;
            cursor: text;
        }

        /* 璋冩暣澶у皬鍜屾棆杞墜鏌?*/
        .resize-handle {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--neon-purple);
            border: 3px solid white;
            border-radius: 50%;
            right: -8px;
            bottom: -8px;
            cursor: nwse-resize;
            display: none;
            z-index: 10000 !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            pointer-events: auto !important;
        }

        .rotate-handle {
            position: absolute;
            width: 16px;
            height: 16px;
            background: var(--neon-orange);
            border: 3px solid white;
            border-radius: 50%;
            top: -8px;
            right: -8px;
            cursor: grab;
            display: none;
            z-index: 10000 !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            pointer-events: auto !important;
        }

        .rotate-handle:active {
            cursor: grabbing;
        }

        .draggable-element.selected .resize-handle,
        .draggable-element.selected .rotate-handle {
            display: block !important;
        }

        /* 鍨冨溇妗?*/
        .trash-zone {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #ff6b6b, #ee5a6f);
            border-radius: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(255, 107, 107, 0.5);
            z-index: 2000;
            animation: trashSlideUp 0.3s ease;
            gap: 5px;
        }

        .trash-zone.active {
            display: flex;
        }

        .trash-zone.hover {
            transform: translateX(-50%) scale(1.15);
            background: linear-gradient(135deg, #ff5252, #f44336);
            box-shadow: 0 15px 50px rgba(255, 107, 107, 0.7);
        }

        .trash-zone-text {
            color: white;
            font-size: 12px;
            font-weight: bold;
            font-family: var(--font-ui);
        }

        @keyframes trashSlideUp {
            from { 
                bottom: -100px;
                opacity: 0;
            }
            to { 
                bottom: 30px;
                opacity: 1;
            }
        }

        /* 全屏和隐私按钮 - 移到工具栏 */
        .control-btn {
            width: 40px;
            height: 40px;
            background: #f5f5f5;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #666;
            border: 1px solid transparent;
        }

        .control-btn:hover {
            background: #fff;
            border-color: var(--neon-purple);
            color: var(--neon-purple);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(157, 78, 221, 0.2);
        }
        
        .control-btn.active {
            background: var(--neon-purple);
            color: white;
            border-color: var(--neon-purple);
        }

        /* 鎶樺彔鎸夐挳 */
        .collapse-btn {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            background: white;
            border: 1px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .collapse-btn:hover {
            background: var(--neon-purple);
            color: white;
            border-color: var(--neon-purple);
        }

        
        .sticker-note {
            min-width: 180px;
            min-height: 180px;
            padding: 20px;
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            box-shadow: 
                0 10px 20px rgba(0,0,0,0.1),
                0 3px 6px rgba(0,0,0,0.05),
                inset 0 -2px 5px rgba(0,0,0,0.05);
            font-family: var(--font-hand);
            font-size: 1.1rem;
            color: #2d3436;
            border-radius: 2px;
            position: relative;
        }

        .sticker-note::before {
            content: '';
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 20px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        .sticker-img {
            min-width: 120px;
            min-height: 120px;
            max-width: 400px;
            max-height: 400px;
            border: 8px solid #fff;
            box-shadow: 
                0 10px 30px rgba(0,0,0,0.15),
                0 3px 10px rgba(0,0,0,0.1);
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: visible; /* 鏀逛负visible锛岃鎵嬫焺鍙互鏄剧ず鍦ㄥ闈?*/
            position: relative;
        }

        .sticker-img img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            pointer-events: none;
            user-select: none;
        }

        .sticker-img .draggable-content {
            pointer-events: none;
            width: 100%;
            height: 100%;
            overflow: hidden; /* 鍐呭瀹瑰櫒淇濇寔hidden */
        }

        .sticker-img .draggable-content * {
            pointer-events: none;
            user-select: none;
        }

        /* 纭繚图片缁勪欢鐨勬墜鏌勫彲瑙?*/
        .sticker-img .resize-handle,
        .sticker-img .rotate-handle {
            pointer-events: auto !important;
            z-index: 1000 !important;
        }

        .sticker-arrow {
            min-width: 120px;
            min-height: 60px;
        }

        .sticker-arrow .draggable-content {
            pointer-events: none;
        }

        .sticker-arrow .draggable-content * {
            pointer-events: none;
        }

        .sticker-textbox {
            min-width: 200px;
            min-height: 100px;
            padding: 15px;
            background: transparent;
            border: none;
            font-family: var(--font-hand);
            font-size: 1.1rem;
            color: #2d3436;
        }

        .sticker-textbox .draggable-content {
            pointer-events: auto;
        }

        .sticker-textbox .draggable-content [contenteditable] {
            pointer-events: auto;
            cursor: text;
            outline: none;
        }
        
        
        /* 时间线已删除 */

        
        .handwritten-h1 {
            font-family: var(--font-display);
            font-size: 3.5rem;
            color: var(--ink-primary);
            line-height: 1;
            margin-bottom: 10px;
        }

        .handwritten-p {
            font-family: var(--font-hand);
            font-size: 1.4rem;
            line-height: 32px;
            color: var(--ink-primary);
            margin: 0;
            padding: 0;
        }

        .pagination {
            position: absolute;
            bottom: 20px;
            right: 40px;
            font-family: var(--font-display);
            font-size: 20px;
            color: #999;
            z-index: 20;
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .page-btn {
            width: 32px; height: 32px;
            border-radius: 50%;
            border: 1px solid #ddd;
            display: flex; 
            align-items: center; 
            justify-content: center;
            cursor: pointer;
            transition: 0.2s;
            font-family: var(--font-ui);
            font-size: 14px;
            background: white;
        }
        
        .page-btn:hover { 
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .page-btn svg {
            width: 14px;
            height: 14px;
        }

        
        .neon-ring {
            position: absolute;
            width: 100px; height: 100px;
            border: 2px solid var(--neon-purple);
            border-radius: 50%;
            opacity: 0.1;
            pointer-events: none;
            bottom: -20px; right: -20px;
        }

        /* 隐私模式样式 - 使用上下两个遮罩层 */
        .privacy-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            z-index: 5;
            display: none;
        }
        
        .privacy-overlay.active {
            display: block;
        }
        
        .privacy-blur-top,
        .privacy-blur-bottom {
            position: absolute;
            left: 0;
            right: 0;
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            background: rgba(253, 251, 247, 0.1);
            pointer-events: none;
        }
        
        .privacy-blur-top {
            top: 0;
        }
        
        .privacy-blur-bottom {
            bottom: 0;
        }
    </style>
</head>
<body vid="8">

    <div class="notebook-chassis" vid="9">
        
        
        <div class="sidebar-spine" vid="10">
            <div class="brand-mark" vid="11">
                笔记
            </div>
            
            <div style="flex-grow: 1;" vid="12" id="notebookList">
                <!-- 笔记本列表将由 JavaScript 动态生成 -->
            </div>

            <div class="p-4 bg-white rounded-xl shadow-sm border border-gray-100 mt-4" vid="29">
                <div class="text-xs text-gray-400 mb-2 font-bold tracking-wider" vid="30">数据管理</div>
                
                <!-- 导出/导入按钮 -->
                <div class="flex gap-2 mb-3">
                    <button onclick="showExportDialog()" class="flex-1 px-3 py-2 bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-lg text-xs font-medium hover:shadow-lg transition" title="导出所有数据">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; margin-right: 4px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="7 10 12 15 17 10"></polyline>
                            <line x1="12" y1="15" x2="12" y2="3"></line>
                        </svg>
                        导出
                    </button>
                    <button onclick="showImportDialog()" class="flex-1 px-3 py-2 bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-lg text-xs font-medium hover:shadow-lg transition" title="导入数据">
                        <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: inline; margin-right: 4px;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                            <polyline points="17 8 12 3 7 8"></polyline>
                            <line x1="12" y1="3" x2="12" y2="15"></line>
                        </svg>
                        导入
                    </button>
                </div>
                
                <!-- 存储信息 -->
                <div class="w-full bg-gray-100 h-1.5 rounded-full overflow-hidden" vid="31">
                    <div class="bg-gradient-to-r from-purple-500 to-orange-400 w-3/4 h-full" vid="32"></div>
                </div>
                <div class="flex justify-between mt-2 text-xs text-gray-500" vid="33">
                    <span vid="34">本地存储</span>
                    <span vid="35">~5MB</span>
                </div>
            </div>
        </div>

        
        <div class="notes-panel" vid="36">
            <button class="expand-btn" onclick="toggleChapters()" title="展开章节">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="9 18 15 12 9 6"></polyline>
                </svg>
            </button>
            
            <div class="flex justify-between items-center mb-6" vid="37">
                <h2 class="text-lg font-bold text-gray-800" vid="38">章节</h2>
                <div class="flex gap-2">
                    <button class="collapse-btn" id="collapseBtn" onclick="toggleChapters()" title="折叠章节">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="15 18 9 12 15 6"></polyline>
                        </svg>
                    </button>
                    <button class="w-8 h-8 rounded-full bg-white border border-gray-200 flex items-center justify-center text-gray-400 hover:text-purple-600 transition" vid="39">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" vid="40"><line x1="12" y1="5" x2="12" y2="19" vid="41"></line><line x1="5" y1="12" x2="19" y2="12" vid="42"></line></svg>
                    </button>
                </div>
            </div>

            <div class="overflow-y-auto pr-2" id="chapterList" vid="43">
                
            </div>
        </div>

        
        <div class="editor-stage" vid="44">
            <div class="palette-bar" vid="45">
                <div class="text-xs font-bold text-gray-400 mr-2 tracking-wider" vid="46">工具</div>
                
                <div class="palette-item" title="便签" onclick="addStickyNote()" vid="47">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" vid="48"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" vid="49"></path><polyline points="14 2 14 8 20 8" vid="50"></polyline><line x1="16" y1="13" x2="8" y2="13" vid="51"></line><line x1="16" y1="17" x2="8" y2="17" vid="52"></line><polyline points="10 9 9 9 8 9" vid="53"></polyline></svg>
                </div>
                <div class="palette-item" title="图片" onclick="document.getElementById('imageUpload').click()" vid="62">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>
                </div>
                <input type="file" id="imageUpload" accept="image/*" style="display:none;" onchange="handleImageUpload(event)">
                <div class="palette-item" title="箭头" onclick="addArrow()" vid="54">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" vid="55"><line x1="5" y1="12" x2="19" y2="12" vid="56"></line><polyline points="12 5 19 12 12 19" vid="57"></polyline></svg>
                </div>
                <div class="palette-item" title="文字框" onclick="addTextBox()" vid="58">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="4 7 4 4 20 4 20 7"></polyline><line x1="9" y1="20" x2="15" y2="20"></line><line x1="12" y1="4" x2="12" y2="20"></line></svg>
                </div>
                
                <!-- 分隔符 -->
                <div style="width: 1px; height: 24px; background: #e0e0e0; margin: 0 4px;"></div>
                
                <!-- 隐私模式按钮 -->
                <div class="control-btn" onclick="togglePrivacyMode()" id="privacyBtn" title="隐私模式">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
                        <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                </div>
                
                <!-- 全屏按钮 -->
                <div class="control-btn" onclick="toggleFullscreen()" title="全屏预览">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"></path>
                    </svg>
                </div>
                
                </div>

            <div class="paper-viewport" id="pageContainer" vid="72">
                
                <div class="paper-page" id="activePaper" vid="73">
                    
                    <div class="paper-hole-punch" vid="74">
                        <div class="hole" vid="75"></div>
                        <div class="hole" vid="76"></div>
                        <div class="hole" vid="77"></div>
                        <div class="hole" vid="78"></div>
                        <div class="hole" vid="79"></div>
                        <div class="hole" vid="80"></div>
                        <div class="hole" vid="81"></div>
                        <div class="hole" vid="82"></div>
                        <div class="hole" vid="83"></div>
                        <div class="hole" vid="84"></div>
                        <div class="hole" vid="85"></div>
                        <div class="hole" vid="86"></div>
                        <div class="hole" vid="87"></div>
                        <div class="hole" vid="88"></div>
                    </div>

                    
                    <div id="pageContent" class="relative h-full" contenteditable="true" style="outline: none;" vid="100">
                        
                    </div>
                    
                    <!-- 隐私模式遮罩层 -->
                    <div class="privacy-overlay" id="privacyOverlay">
                        <div class="privacy-blur-top" id="privacyBlurTop"></div>
                        <div class="privacy-blur-bottom" id="privacyBlurBottom"></div>
                    </div>
                </div>
            </div>

            
            <div class="pagination" vid="102">
                <button class="page-btn" onclick="App.deleteCurrentPage()" title="删除页面" style="background: #ff6b6b; color: white;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="3 6 5 6 21 6"></polyline>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                    </svg>
                </button>
                <button class="page-btn" onclick="changePage(-1)" vid="103">←</button>
                <span vid="104">
                    <span id="pageInfo" style="font-size: 14px; color: #999;">1 / 1</span>
                    <br>
                    <span style="font-size: 12px; color: #ccc;">第 <span id="pageNum" vid="105">1</span> 页</span>
                </span>
                <button class="page-btn" onclick="changePage(1)" vid="106">→</button>
                <button class="page-btn" onclick="App.addNewPage()" title="添加新页面" style="background: var(--neon-purple); color: white;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <line x1="12" y1="5" x2="12" y2="19"></line>
                        <line x1="5" y1="12" x2="19" y2="12"></line>
                    </svg>
                </button>
            </div>
        </div>

    </div>

    <!-- 垃圾桶 -->
    <div class="trash-zone" id="trashZone">
        <svg xmlns="http://www.w3.org/2000/svg" width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            <line x1="10" y1="11" x2="10" y2="17"></line>
            <line x1="14" y1="11" x2="14" y2="17"></line>
        </svg>
        <span class="trash-zone-text">拖到这里删除</span>
    </div>

    
        <!-- 模块化 JS 文件 -->
    <script src="js/storage.js"></script>
    <script src="js/imageUtils.js"></script>
    <script src="js/dragManager.js"></script>
    <script src="js/annotationManager.js"></script>
    <script src="js/sampleData.js"></script>
    <script src="js/app.js"></script>

        <script>
    // 隐私模式功能 - 使用clip-path镂空方式，始终保持最新3个字清晰
    let privacyModeEnabled = false;
    const CLEAR_CHAR_COUNT = 3; // 清晰显示的字符数

    function togglePrivacyMode() {
        privacyModeEnabled = !privacyModeEnabled;
        const pageContent = document.getElementById('pageContent');
        const privacyOverlay = document.getElementById('privacyOverlay');
        const privacyBtn = document.getElementById('privacyBtn');
        
        if (privacyModeEnabled) {
            privacyOverlay.classList.add('active');
            privacyBtn.classList.add('active');
            updateClearArea();
            // 监听输入、光标移动、滚动事件
            pageContent.addEventListener('input', updateClearArea);
            pageContent.addEventListener('click', updateClearArea);
            pageContent.addEventListener('keyup', updateClearArea);
            pageContent.addEventListener('scroll', updateClearArea);
        } else {
            privacyOverlay.classList.remove('active');
            privacyBtn.classList.remove('active');
            // 移除监听
            pageContent.removeEventListener('input', updateClearArea);
            pageContent.removeEventListener('click', updateClearArea);
            pageContent.removeEventListener('keyup', updateClearArea);
            pageContent.removeEventListener('scroll', updateClearArea);
        }
    }

    // 核心函数：更新模糊层，露出最新3个字
    function updateClearArea() {
        if (!privacyModeEnabled) return;
        
        const pageContent = document.getElementById('pageContent');
        const blurTop = document.getElementById('privacyBlurTop');
        const blurBottom = document.getElementById('privacyBlurBottom');
        const selection = window.getSelection();
        
        if (!selection || selection.rangeCount === 0) {
            // 无选区时全模糊
            blurTop.style.height = '100%';
            blurBottom.style.height = '0';
            return;
        }
        
        const range = selection.getRangeAt(0);
        const containerRect = pageContent.getBoundingClientRect();
        
        // 获取光标前的文本
        let targetTextNode = range.startContainer;
        
        // 确保获取到文本节点
        if (targetTextNode.nodeType !== Node.TEXT_NODE) {
            // 如果是元素节点，尝试获取其文本子节点
            if (targetTextNode.childNodes.length > 0) {
                targetTextNode = targetTextNode.childNodes[range.startOffset - 1] || targetTextNode.firstChild;
            } else {
                targetTextNode = targetTextNode.firstChild;
            }
            if (!targetTextNode || targetTextNode.nodeType !== Node.TEXT_NODE) {
                blurTop.style.height = '100%';
                blurBottom.style.height = '0';
                return;
            }
        }
        
        const fullText = targetTextNode.textContent;
        const cursorOffset = range.startOffset;
        const textBeforeCursor = fullText.substring(0, cursorOffset);
        
        // 确定需要清晰显示的文本范围（最后3个字符）
        const startIndex = Math.max(0, textBeforeCursor.length - CLEAR_CHAR_COUNT);
        const clearTextLength = textBeforeCursor.length - startIndex;
        
        if (clearTextLength === 0) {
            // 无文本时全模糊
            blurTop.style.height = '100%';
            blurBottom.style.height = '0';
            return;
        }
        
        // 创建临时Range，定位清晰显示的文本区域
        const clearRange = document.createRange();
        try {
            clearRange.setStart(targetTextNode, startIndex);
            clearRange.setEnd(targetTextNode, cursorOffset);
            
            // 计算清晰区域相对于编辑区的位置
            const clearRect = clearRange.getBoundingClientRect();
            const relativeTop = clearRect.top - containerRect.top + pageContent.scrollTop;
            const relativeBottom = containerRect.height - (clearRect.bottom - containerRect.top + pageContent.scrollTop);
            
            // 添加一些padding
            const padding = 4;
            const topHeight = Math.max(0, relativeTop - padding);
            const bottomHeight = Math.max(0, relativeBottom - padding);
            
            // 设置上下遮罩层的高度
            blurTop.style.height = topHeight + 'px';
            blurBottom.style.height = bottomHeight + 'px';
            
            // 销毁临时Range
            clearRange.detach();
        } catch (e) {
            // 如果出错，全模糊
            blurTop.style.height = '100%';
            blurBottom.style.height = '0';
        }
    }
    </script>
</body></html>
