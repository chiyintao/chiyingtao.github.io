# 笔记本管理功能说明

## 文件说明

### 原始版本
- **文件**: `little-prince-journal.html`
- **特点**: 单文件包含所有代码（HTML + CSS + JavaScript）
- **大小**: ~1600 行代码
- **优点**: 简单，无需额外文件
- **缺点**: 代码耦合，难以维护

### 模块化版本
- **文件**: `little-prince-journal-modular.html`
- **特点**: HTML + CSS + 模块化 JavaScript
- **结构**:
  ```
  little-prince-journal-modular.html  (主文件，只包含 HTML 和 CSS)
  js/
    ├── storage.js              (数据存储模块)
    ├── imageUtils.js           (图片处理模块)
    ├── dragManager.js          (拖拽管理模块)
    ├── annotationManager.js    (组件管理模块)
    └── app.js                  (主应用入口)
  ```
- **优点**: 
  - 代码分离，职责清晰
  - 易于维护和扩展
  - 可复用模块
  - 便于团队协作

## 功能特性

### 已实现功能
1. ✅ 章节侧边栏（可折叠）
2. ✅ 全屏预览模式
3. ✅ 四种工具：便签、图片、箭头、文字框
4. ✅ 组件拖拽、缩放、旋转
5. ✅ 垃圾桶删除（拖动时显示）
6. ✅ 图片自动压缩（>500KB）
7. ✅ 自动保存（页面内容 + 组件布局）
8. ✅ 数据持久化（localStorage）

### 待实现功能
1. ⏳ 笔记本管理（添加、编辑、删除）
2. ⏳ 章节管理（添加、编辑、删除）
3. ⏳ 标题可编辑功能

## 使用说明

### 打开应用
- **原始版本**: 直接打开 `little-prince-journal.html`
- **模块化版本**: 直接打开 `little-prince-journal-modular.html`

### 工具使用
- **便签**: 点击便签图标，可编辑内容
- **图片**: 点击图片图标上传，自动压缩大图
- **箭头**: 点击箭头图标添加指示箭头
- **文字框**: 点击文字框图标添加透明文本

### 组件操作
- **拖动**: 鼠标按住组件拖动
- **缩放**: 拖动右下角紫色手柄
- **旋转**: 拖动右上角橙色手柄
- **删除**: 拖动组件到底部垃圾桶

### 数据保存
- 页面内容：输入后 1 秒自动保存
- 组件布局：操作后 0.5 秒自动保存
- 所有数据存储在浏览器 localStorage

## 技术架构

### 模块职责

#### storage.js - 数据存储
- localStorage 封装
- 笔记本/章节/页面/组件数据管理
- 错误处理和容量检查

#### imageUtils.js - 图片处理
- 图片压缩（目标 ≤500KB）
- 加载提示 UI
- 格式转换

#### dragManager.js - 拖拽管理
- 拖拽状态管理
- 鼠标事件处理
- 碰撞检测（垃圾桶）

#### annotationManager.js - 组件管理
- 创建/删除组件
- 组件事件绑定
- 组件保存/加载

#### app.js - 主应用
- 应用初始化
- 模块协调
- 全局事件处理

### 模块间通信
使用自定义事件进行模块间通信：

```javascript
// 发送事件
window.dispatchEvent(new CustomEvent('annotationsChanged'));

// 监听事件
window.addEventListener('annotationsChanged', () => {
    // 处理逻辑
});
```

## 开发指南

### 添加新功能
1. 确定功能属于哪个模块
2. 在对应模块文件中添加代码
3. 如需跨模块通信，使用事件系统
4. 更新本文档

### 调试技巧
- 打开浏览器开发者工具（F12）
- 查看 Console 面板的日志输出
- 检查 Application > Local Storage 查看存储数据
- 使用 Sources 面板调试 JavaScript

### 常见问题

**Q: 图片保存失败？**
A: 检查图片大小，建议使用 <500KB 的图片。系统会自动压缩，但超大图片可能仍超出 localStorage 限制（5-10MB）。

**Q: 数据丢失？**
A: localStorage 数据与浏览器绑定，清除浏览器数据会导致丢失。建议定期导出重要数据（功能待开发）。

**Q: 模块化版本不工作？**
A: 确保所有 JS 文件在 `js/` 目录下，且文件路径正确。某些浏览器可能因安全策略限制本地文件加载，建议使用本地服务器（如 Live Server）。

## 下一步计划

1. 修复字符编码问题（中文显示）
2. 实现笔记本管理功能
3. 实现章节管理功能
4. 添加标题编辑功能
5. 添加数据导出/导入功能
6. 优化移动端体验

## 更新日志

### 2026-02-05
- ✅ 创建模块化版本
- ✅ 拆分 JavaScript 代码到独立模块
- ✅ 保持所有原有功能
- ⏳ 待修复：字符编码问题
